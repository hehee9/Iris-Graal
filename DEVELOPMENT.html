<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iris-Graal ê°œë°œ ë¬¸ì„œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --text-tertiary: #adb5bd;
            --border-color: #dee2e6;
            --accent: #0066cc;
            --accent-hover: #0052a3;
            --code-bg: #f5f5f5;
            --sidebar-width: 280px;
            --header-height: 60px;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3d3d3d;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --text-tertiary: #6c757d;
            --border-color: #495057;
            --code-bg: #2d2d2d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 2rem;
            z-index: 1000;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-actions {
            margin-left: auto;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
            width: 250px;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .theme-toggle {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .theme-toggle:hover {
            background-color: var(--bg-tertiary);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background-color: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 1.5rem 0;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 0.25rem;
        }

        .sidebar-nav a {
            display: block;
            padding: 0.5rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s, background-color 0.2s;
        }

        .sidebar-nav a:hover {
            color: var(--accent);
            background-color: var(--bg-tertiary);
        }

        .sidebar-nav a.active {
            color: var(--accent);
            font-weight: 600;
            background-color: var(--bg-tertiary);
        }

        .sidebar-nav .section-title {
            padding: 0.75rem 1.5rem 0.5rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-tertiary);
            font-weight: 700;
        }

        .sidebar-nav .subsection {
            padding-left: 2.5rem;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 3rem;
            max-width: 900px;
        }

        .main-content h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .main-content h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-top: 3rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            color: var(--text-primary);
        }

        .main-content h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .main-content h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .main-content p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .main-content ul, .main-content ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .main-content li {
            margin-bottom: 0.5rem;
        }

        .main-content a {
            color: var(--accent);
            text-decoration: none;
        }

        .main-content a:hover {
            text-decoration: underline;
        }

        /* Code Blocks */
        pre {
            background-color: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            overflow-x: auto;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            background-color: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid var(--border-color);
        }

        th {
            background-color: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-primary);
        }

        td {
            color: var(--text-secondary);
        }

        /* Blockquote */
        blockquote {
            border-left: 4px solid var(--accent);
            padding-left: 1rem;
            margin: 1.5rem 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Alert Boxes */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            border-left: 4px solid;
        }

        .alert-warning {
            background-color: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-info {
            background-color: #d1ecf1;
            border-color: #0dcaf0;
            color: #055160;
        }

        .alert-success {
            background-color: #d1e7dd;
            border-color: #198754;
            color: #0f5132;
        }

        [data-theme="dark"] .alert-warning {
            background-color: #332701;
            color: #ffca2c;
        }

        [data-theme="dark"] .alert-info {
            background-color: #032830;
            color: #6edff6;
        }

        [data-theme="dark"] .alert-success {
            background-color: #051b11;
            color: #75b798;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }

        /* Search Results */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-top: 0.5rem;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }

        .search-results.show {
            display: block;
        }

        .search-result-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-result-item:hover {
            background-color: var(--bg-tertiary);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .search-result-excerpt {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .highlight {
            background-color: #ffeb3b;
            color: #000;
            padding: 0 0.2em;
            border-radius: 2px;
        }

        [data-theme="dark"] .highlight {
            background-color: #ffc107;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 2rem 1rem;
            }

            .search-input {
                width: 150px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>Iris-Graal ê°œë°œ ë¬¸ì„œ</h1>
        <div class="header-actions">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="ê²€ìƒ‰..." id="searchInput">
                <div class="search-results" id="searchResults"></div>
            </div>
            <button class="theme-toggle" id="themeToggle">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
        </div>
    </header>

    <!-- Sidebar -->
    <nav class="sidebar">
        <ul class="sidebar-nav">
            <li class="section-title">ì‹œì‘í•˜ê¸°</li>
            <li><a href="#overview" class="nav-link">í”„ë¡œì íŠ¸ ê°œìš”</a></li>
            <li><a href="#migration" class="nav-link">ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ</a></li>
            <li class="subsection"><a href="#legacy-migration" class="nav-link">ë ˆê±°ì‹œ API</a></li>
            <li class="subsection"><a href="#api2-migration" class="nav-link">API2</a></li>

            <li class="section-title">ì•„í‚¤í…ì²˜</li>
            <li><a href="#architecture" class="nav-link">ì „ì²´ êµ¬ì¡°</a></li>
            <li><a href="#message-flow" class="nav-link">ë©”ì‹œì§€ í”Œë¡œìš°</a></li>
            <li><a href="#threading" class="nav-link">ìŠ¤ë ˆë”© ëª¨ë¸</a></li>

            <li class="section-title">ê°œë°œ ê°€ì´ë“œ</li>
            <li><a href="#feature-guide" class="nav-link">Feature ê°œë°œ</a></li>
            <li><a href="#message-handler" class="nav-link">ë©”ì‹œì§€ í•¸ë“¤ëŸ¬</a></li>
            <li><a href="#feed-handler" class="nav-link">í”¼ë“œ í•¸ë“¤ëŸ¬</a></li>
            <li><a href="#schedule" class="nav-link">ìŠ¤ì¼€ì¤„ ì‘ì—…</a></li>

            <li class="section-title">API ë ˆí¼ëŸ°ìŠ¤</li>
            <li><a href="#api-message" class="nav-link">Message ê°ì²´</a></li>
            <li><a href="#api-feed" class="nav-link">Feed ê°ì²´</a></li>
            <li><a href="#api-router" class="nav-link">Router API</a></li>
            <li><a href="#api-queue" class="nav-link">Queue & Sender</a></li>
            <li><a href="#api-hydrator" class="nav-link">Hydrator</a></li>
            <li><a href="#api-utils" class="nav-link">Utils</a></li>
            <li><a href="#api-kakaolink" class="nav-link">KakaoLink</a></li>

            <li class="section-title">ê³ ê¸‰ ì£¼ì œ</li>
            <li><a href="#thread-safety" class="nav-link">Thread Safety</a></li>
            <li><a href="#performance" class="nav-link">ì„±ëŠ¥ ìµœì í™”</a></li>

            <li class="section-title">ë¬¸ì œ í•´ê²°</li>
            <li><a href="#troubleshooting" class="nav-link">ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜</a></li>
            <li><a href="#debugging" class="nav-link">ë””ë²„ê¹… íŒ</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <section id="overview">
            <h1>Iris-Graal ê°œë°œ ë¬¸ì„œ</h1>
            <blockquote>MessengerBot R 0.7.40+ ê¸°ë°˜ ì¹´ì¹´ì˜¤í†¡ ë´‡ í”„ë ˆì„ì›Œí¬</blockquote>

            <h2>í”„ë¡œì íŠ¸ ê°œìš”</h2>

            <h3>Iris-Graalì´ë€?</h3>
            <p>Iris-Graalì€ MessengerBot R 0.7.40+ í™˜ê²½ì—ì„œ ë™ì‘í•˜ëŠ” ëª¨ë˜ ì¹´ì¹´ì˜¤í†¡ ë´‡ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. GraalJS ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ê°€ì§‘ë‹ˆë‹¤:</p>
            <ul>
                <li><strong>Thread-Safe ì•„í‚¤í…ì²˜</strong>: Java Thread Poolê³¼ Script Main Thread ë¶„ë¦¬</li>
                <li><strong>Queue ê¸°ë°˜ ì „ì†¡ ì‹œìŠ¤í…œ</strong>: Rate Limiting ë° ì¬ì‹œë„ ë¡œì§ ë‚´ì¥</li>
                <li><strong>ëª¨ë“ˆí™”ëœ êµ¬ì¡°</strong>: CommonJS ëª¨ë“ˆ ì‹œìŠ¤í…œ í™œìš©</li>
                <li><strong>Feature í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ</strong>: ê¸°ëŠ¥ë³„ ë…ë¦½ì  ê°œë°œ ë° ê´€ë¦¬</li>
                <li><strong>Type-Safe</strong>: JSDoc ê¸°ë°˜ íƒ€ì… ì •ì˜</li>
            </ul>
        </section>

        <section id="migration">
            <h2>ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ</h2>

            <h3 id="legacy-migration">ë ˆê±°ì‹œ API â†’ Iris-Graal</h3>

            <h4>ê¸°ë³¸ êµ¬ì¡° ë³€ê²½</h4>
            <p><strong>Before (ë ˆê±°ì‹œ API)</strong></p>
            <pre><code>function response(room, msg, sender, isGroupChat, replier, imageDB, packageName) {
    if (msg === "!ì•ˆë…•") {
        replier.reply("ì•ˆë…•í•˜ì„¸ìš”!");
    }
}</code></pre>

            <p><strong>After (Iris-Graal)</strong></p>
            <pre><code>/**
 * @typedef {object} Message
 * @property {Author} author ë°œì‹ ì ì •ë³´
 * @property {Room} room ë°© ì •ë³´
 * @property {string} content ì „ì²´ ë©”ì‹œì§€ ë¬¸ìì—´
 * @property {string} id ë©”ì‹œì§€ id
 * @property {string} type ë©”ì‹œì§€ íƒ€ì… ë²ˆí˜¸, ì •ìˆ˜í˜• ë¬¸ìì—´
 * @property {boolean} isMine ë‚´ê°€(ë´‡ì´) ë³´ë‚¸ ë©”ì‹œì§€ì¸ì§€ ì—¬ë¶€
 * @property {Reply|null} reply ë‹µì¥ ì •ë³´
 * @property {Mention[]} mention ë©˜ì…˜ ì •ë³´
 * @property {Attachment[]} attachment ì²¨ë¶€íŒŒì¼ ì •ë³´
 * @property {(text: string) => boolean} send í…ìŠ¤íŠ¸ ì‘ë‹µ ì „ì†¡, í•­ìƒ true ë°˜í™˜
 * @property {(media: string|string[], timeoutMs?: number, fileName?: string) => boolean} sendMedia íŒŒì¼ ì‘ë‹µ ì „ì†¡, í•­ìƒ true ë°˜í™˜
 */
function onMessage(msg) {
    if (msg.content === "!ì•ˆë…•") {
        return msg.send("ì•ˆë…•í•˜ì„¸ìš”!");
    }
}

/** @description ê¸°ëŠ¥ ë“±ë¡ */
function register({ registerMessage }) {
    registerMessage(onMessage);
}

/* ë˜ëŠ”
function register(context) {
    context.registerMessage((msg) => {
        if (msg.content === "!ì•ˆë…•") {
            return msg.send("ì•ˆë…•í•˜ì„¸ìš”!");
        }
    });
}
*/

module.exports = { register };</code></pre>

            <h4>ì£¼ìš” ë³€ê²½ ì‚¬í•­</h4>
            <table>
                <thead>
                    <tr>
                        <th>ë ˆê±°ì‹œ API</th>
                        <th>Iris-Graal</th>
                        <th>ë¹„ê³ </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>msg</code></td>
                        <td><code>msg.content</code></td>
                        <td>ë©”ì‹œì§€ ë‚´ìš©</td>
                    </tr>
                    <tr>
                        <td><code>sender</code></td>
                        <td><code>msg.author.name</code></td>
                        <td>ë°œì‹ ì ì´ë¦„</td>
                    </tr>
                    <tr>
                        <td><code>room</code></td>
                        <td><code>msg.room.name</code></td>
                        <td>ë°© ì´ë¦„</td>
                    </tr>
                    <tr>
                        <td><code>replier.reply(text)</code></td>
                        <td><code>msg.send(text)</code></td>
                        <td>í…ìŠ¤íŠ¸ ì „ì†¡</td>
                    </tr>
                    <tr>
                        <td><code>replier.reply(ImageDB.getProfileBase64())</code></td>
                        <td><code>msg.sendMedia(url)</code></td>
                        <td>ë¯¸ë””ì–´ ì „ì†¡</td>
                    </tr>
                    <tr>
                        <td>ì „ì—­ ë³€ìˆ˜</td>
                        <td>ëª¨ë“ˆ ìŠ¤ì½”í”„</td>
                        <td>ìƒíƒœ ê´€ë¦¬</td>
                    </tr>
                </tbody>
            </table>

            <h3 id="api2-migration">API2 â†’ Iris-Graal</h3>
            <p>API2ëŠ” ë ˆê±°ì‹œ APIì˜ ê°œì„ íŒì´ì§€ë§Œ, Iris-Graalê³¼ëŠ” êµ¬ì¡°ê°€ ë‹¤ë¦…ë‹ˆë‹¤.</p>

            <p><strong>Before (API2)</strong></p>
            <pre><code>const bot = BotManager.getCurrentBot();

function onMessage(msg) {
    if (msg.content === "!ì•ˆë…•") {
        msg.reply("ì•ˆë…•í•˜ì„¸ìš”!");
    }
};

bot.addListener(Event.MESSAGE, onMessage);</code></pre>

            <p><strong>After (Iris-Graal)</strong></p>
            <pre><code>function onMessage(msg) {
    if (msg.content === "!ì•ˆë…•") {
        return msg.send("ì•ˆë…•í•˜ì„¸ìš”!");
    }
}

/** @description ê¸°ëŠ¥ ë“±ë¡ */
function register({ registerMessage }) {
    registerMessage(onMessage);
}

module.exports = { register };</code></pre>
        </section>

        <section id="architecture">
            <h2>ì•„í‚¤í…ì²˜</h2>

            <h3>ì „ì²´ êµ¬ì¡°</h3>
            <pre><code>main.js (ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸)
â”œâ”€â”€ node_modules/
â”‚   â”œâ”€â”€ core/           # í•µì‹¬ ë¡œì§
â”‚   â”‚   â”œâ”€â”€ router.js       # ë©”ì‹œì§€ ë¼ìš°íŒ…
â”‚   â”‚   â”œâ”€â”€ schedule.js     # ì£¼ê¸° ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬
â”‚   â”‚   â””â”€â”€ featurePolicy.js # ê¸°ëŠ¥ on/off ê´€ë¦¬
â”‚   â”œâ”€â”€ infra/          # ì¸í”„ë¼ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ httpServer.js   # HTTP ì›¹í›… ìˆ˜ì‹ 
â”‚   â”‚   â”œâ”€â”€ ingress.js      # ì´ë²¤íŠ¸ ë¶„ë°°
â”‚   â”‚   â”œâ”€â”€ queue.js        # ì „ì†¡ í ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ sender.js       # ì‹¤ì œ ì „ì†¡ ë‹´ë‹¹
â”‚   â”‚   â””â”€â”€ roomRegistry.js # ë°© ì •ë³´ ìºì‹œ
â”‚   â”œâ”€â”€ adapters/       # ì™¸ë¶€ ì‹œìŠ¤í…œ ì–´ëŒ‘í„°
â”‚   â”‚   â”œâ”€â”€ kakao/
â”‚   â”‚   â”‚   â”œâ”€â”€ parser.js   # ë©”ì‹œì§€ íŒŒì‹±
â”‚   â”‚   â”‚   â””â”€â”€ hydrator.js # DB ì¡°íšŒ ë° ë°ì´í„° ë³´ê°•
â”‚   â”‚   â””â”€â”€ external/
â”‚   â”‚       â””â”€â”€ kakaolink.js # ì¹´ì¹´ì˜¤ë§í¬ ì „ì†¡
â”‚   â”œâ”€â”€ shared/         # ê³µìš© ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â”œâ”€â”€ config.js       # ì„¤ì • ìƒìˆ˜
â”‚   â”‚   â”œâ”€â”€ types.js        # íƒ€ì… ì •ì˜
â”‚   â”‚   â”œâ”€â”€ logger.js       # ë¡œê¹… ì‹œìŠ¤í…œ
â”‚   â”‚   â””â”€â”€ utils.js        # ë²”ìš© ìœ í‹¸
â”‚   â””â”€â”€ features/       # ê¸°ëŠ¥ ëª¨ë“ˆ
â”‚       â”œâ”€â”€ moderation.js   # ë°´/ì–¸ë°´ ê´€ë¦¬
â”‚       â”œâ”€â”€ memberFeed.js   # ì…í‡´ì¥ ê°ì§€
â”‚       â””â”€â”€ ...</code></pre>

            <h3 id="message-flow">ë©”ì‹œì§€ í”Œë¡œìš°</h3>
            <pre><code>ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [httpServer.js]                         â”‚
â”‚ Java Thread Poolì—ì„œ HTTP POST ìˆ˜ì‹       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ConcurrentLinkedQueue]                 â”‚
â”‚ Thread-safe íì— ì €ì¥                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Pump ë©”ì»¤ë‹ˆì¦˜]                          â”‚
â”‚ 50msë§ˆë‹¤ í í”ŒëŸ¬ì‹œ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ingress.js]                            â”‚
â”‚ Raw ë°ì´í„° ë¶„ë¥˜ (message/feed)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [router.js]                             â”‚
â”‚ Priority ìˆœìœ¼ë¡œ í•¸ë“¤ëŸ¬ ì‹¤í–‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [queue.js]                              â”‚
â”‚ í…ìŠ¤íŠ¸/ë¯¸ë””ì–´ í (Rate Limiting)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ì¹´ì¹´ì˜¤í†¡ ì‘ë‹µ ì „ì†¡</code></pre>

            <h3 id="threading">ìŠ¤ë ˆë”© ëª¨ë¸</h3>
            <div class="alert alert-warning">
                <strong>âš ï¸ ì¤‘ìš”:</strong> Java Threadì—ì„œëŠ” Bot.* ë˜ëŠ” MediaSender.* í˜¸ì¶œì„ ì§€ì–‘í•˜ì„¸ìš”
            </div>

            <h4>1. Java Thread Pool (HTTP Server)</h4>
            <ul>
                <li><strong>ì—­í• </strong>: ServerSocket.accept() ëŒ€ê¸°, HTTP ìš”ì²­ ìˆ˜ì‹  ë° íŒŒì‹±, ConcurrentQueueì— ë°ì´í„° ì¶”ê°€</li>
                <li><strong>ì£¼ì˜</strong>: Bot.* ë˜ëŠ” MediaSender.* í˜¸ì¶œ ì§€ì–‘, ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ ì£¼ì˜</li>
            </ul>

            <h4>2. Main Script Thread</h4>
            <ul>
                <li><strong>ì—­í• </strong>: Pumpê°€ íë¥¼ ë¹„ì›Œì„œ ì²˜ë¦¬, ëª¨ë“  Bot.send, MediaSender í˜¸ì¶œ, Timer, setTimeout ì‹¤í–‰, Queue ì²˜ë¦¬</li>
                <li><strong>íŠ¹ì§•</strong>: ë‹¨ì¼ ìŠ¤ë ˆë“œ â†’ ë™ê¸°í™” ë¶ˆí•„ìš”, Bot API ì•ˆì „í•˜ê²Œ í˜¸ì¶œ ê°€ëŠ¥</li>
            </ul>

            <h4>3. Background Thread (ingress)</h4>
            <ul>
                <li><strong>ì—­í• </strong>: App.runOnBackgroundThreadë¡œ íŒŒì‹± ì‹¤í–‰, í•¸ë“¤ëŸ¬ ì‹¤í–‰ (CPU ì§‘ì•½ì  ì‘ì—…)</li>
                <li><strong>íŠ¹ì§•</strong>: ë©”ì¸ ìŠ¤ë ˆë“œ ë¶€í•˜ ë¶„ì‚°, Bot API í˜¸ì¶œ ì‹œ í ì‚¬ìš© í•„ìˆ˜</li>
            </ul>
        </section>

        <section id="feature-guide">
            <h2>Feature ê°œë°œ ê°€ì´ë“œ</h2>

            <h3>ê¸°ë³¸ í…œí”Œë¦¿</h3>
            <pre><code>const _SCRIPT_NAME = "example.js";
const { Logger } = require("shared/logger");
const { parseCommand } = require("shared/utils");

// ëª¨ë“ˆ ìŠ¤ì½”í”„ ë³€ìˆ˜ (ê¸°ëŠ¥ë³„ ìƒíƒœ ì €ì¥)
const state = {};

/**
 * @description ë©”ì‹œì§€ í•¸ë“¤ëŸ¬
 * @param {import("shared/types").Message} msg
 * @returns {boolean|void} trueë¥¼ ë°˜í™˜í•˜ë©´ ì´í›„ í•¸ë“¤ëŸ¬ ì¤‘ë‹¨
 */
function handleMessage(msg) {
    const { cmd, args } = parseCommand(msg.content);

    if (cmd === "ì•ˆë…•") {
        return msg.send("ì•ˆë…•í•˜ì„¸ìš”!");
    }

    // ì¡°ê±´ì— ë§ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ í•¸ë“¤ëŸ¬ë¡œ ì§„í–‰ (return ì—†ìŒ)
}

/**
 * @description í”¼ë“œ í•¸ë“¤ëŸ¬
 * @param {import("shared/types").Feed} feed
 */
function handleJoin(feed) {
    // ì…ì¥ ì‹œ í™˜ì˜ ë©”ì‹œì§€
    feed.send("í™˜ì˜í•©ë‹ˆë‹¤!");
}

/**
 * @description Feature ë“±ë¡
 * @param {object} context
 * @param {(handler: Function, priority?: number) => void} context.registerMessage
 * @param {(feedType: number, handler: Function, priority?: number) => void} context.registerFeed
 */
function register(context) {
    // ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ ë“±ë¡
    context.registerMessage(handleMessage);

    // í”¼ë“œ í•¸ë“¤ëŸ¬ ë“±ë¡ (4: ì…ì¥, 2: í‡´ì¥, 6: ê°•í‡´)
    context.registerFeed(4, handleJoin);
}

module.exports = { register };</code></pre>

            <h3 id="message-handler">ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ ì‘ì„±</h3>

            <h4>Priority ì‹œìŠ¤í…œ</h4>
            <p>í•¸ë“¤ëŸ¬ëŠ” <strong>Priority ê°’ì´ ë†’ì„ìˆ˜ë¡ ë¨¼ì € ì‹¤í–‰</strong>ë©ë‹ˆë‹¤.</p>
            <pre><code>context.registerMessage(adminHandler, 1000);  // ê°€ì¥ ë¨¼ì € ì‹¤í–‰
context.registerMessage(coreHandler, 500);    // 2ë²ˆì§¸
context.registerMessage(normalHandler, 100);  // ê¸°ë³¸
context.registerMessage(fallbackHandler, 20); // ë§ˆì§€ë§‰</code></pre>

            <h4>í•¸ë“¤ëŸ¬ ì¤‘ë‹¨</h4>
            <pre><code>function handler(msg) {
    const { cmd } = parseCommand(msg.content);

    // âœ… return msg.send()ë¡œ ê°„ê²°í•˜ê²Œ
    if (cmd === "ë„ì›€ë§") {
        return msg.send("ë„ì›€ë§ ë‚´ìš©...");
    }

    // ì¡°ê±´ ë¶ˆë§Œì¡± ì‹œ return ì—†ìŒ (ë‹¤ìŒ í•¸ë“¤ëŸ¬ ì§„í–‰)
}</code></pre>

            <h3 id="feed-handler">í”¼ë“œ í•¸ë“¤ëŸ¬ ì‘ì„±</h3>
            <pre><code>function register(context) {
    context.registerFeed(4, handleJoin);   // ì…ì¥
    context.registerFeed(2, handleLeave);  // í‡´ì¥
    context.registerFeed(6, handleKick);   // ê°•í‡´
}

function handleJoin(feed) {
    feed.send("í™˜ì˜í•©ë‹ˆë‹¤!");
}</code></pre>

            <h3 id="schedule">ìŠ¤ì¼€ì¤„ ì‘ì—… ë“±ë¡</h3>
            <pre><code>const { registerPeriodic } = require("core/schedule");
const { Logger } = require("shared/logger");

function register(context) {
    // ì£¼ê¸° ì‘ì—… ë“±ë¡ (10ì´ˆë§ˆë‹¤ ì‹¤í–‰)
    registerPeriodic({
        id: "my-task",                // ê³ ìœ  ID (ì„ íƒ)
        intervalMs: 10000,            // 10ì´ˆ
        handler: onTick,              // í•¸ë“¤ëŸ¬ í•¨ìˆ˜
        featureName: "ê¸°ëŠ¥ëª…",         // Feature Policy ì—°ë™
        roomId: "123456789",          // ë°©ë³„ í† ê¸€ (ì„ íƒ)
        alignToTick: true             // ë“±ë¡ ì‹œì  ê¸°ì¤€ ì •ë ¬
    });
}

function onTick(now) {
    // now: í˜„ì¬ íƒ€ì„ìŠ¤íƒ¬í”„
    Logger.d("onTick", "10ì´ˆë§ˆë‹¤ ì‹¤í–‰ë¨: " + now);
}</code></pre>
        </section>

        <section id="api-message">
            <h2>API ë ˆí¼ëŸ°ìŠ¤</h2>

            <h3>Message ê°ì²´</h3>
            <pre><code>interface Message {
    // ê¸°ë³¸ ì •ë³´
    content: string;              // ë©”ì‹œì§€ ë‚´ìš©
    id: string;                   // ë©”ì‹œì§€ ID, ì •ìˆ˜í˜• ë¬¸ìì—´
    type: string;                 // ë©”ì‹œì§€ íƒ€ì… ("1", "2", ...)
    isMine: boolean;              // ë´‡ì´ ë³´ë‚¸ ë©”ì‹œì§€ ì—¬ë¶€

    // ë°œì‹ ì ì •ë³´
    author: {
        name: string;             // ë°œì‹ ì ì´ë¦„
        userId: string;           // ë°œì‹ ì ID, ì •ìˆ˜í˜• ë¬¸ìì—´
        isBanned: boolean;        // ì°¨ë‹¨ ì—¬ë¶€
    };

    // ë°© ì •ë³´
    room: {
        name: string;             // ë°© ì´ë¦„
        channelId: string;        // ë°© ID, ì •ìˆ˜í˜• ë¬¸ìì—´
        isGroupChat: boolean;     // ë‹¨ì²´ ì±„íŒ…ë°© ì—¬ë¶€
        isOpenChat: boolean;      // ì˜¤í”ˆ ì±„íŒ…ë°© ì—¬ë¶€
    };

    // ì²¨ë¶€íŒŒì¼
    attachment: Array<{
        type: string;             // "image", "video", "audio", ...
        mime: string;             // MIME íƒ€ì…
        url: string;              // ë‹¤ìš´ë¡œë“œ URL
        size: number;             // íŒŒì¼ í¬ê¸° (byte)
        name?: string;            // íŒŒì¼ëª…
    }>;

    // ë‹µì¥
    reply: {
        srcId: string;            // ì›ë³¸ ë©”ì‹œì§€ ID, ì •ìˆ˜í˜• ë¬¸ìì—´
        srcUserId: string;        // ì›ë³¸ ë°œì‹ ì ID, ì •ìˆ˜í˜• ë¬¸ìì—´
        srcType: string;          // ì›ë³¸ ë©”ì‹œì§€ íƒ€ì…
    } | null;

    // ë©˜ì…˜
    mention: Array<{
        srcUserId: string;        // ë©˜ì…˜ëœ ì‚¬ìš©ì ID, ì •ìˆ˜í˜• ë¬¸ìì—´
        at: number[];             // ë©˜ì…˜ ìœ„ì¹˜ (1ë¶€í„° ì‹œì‘)
        len: number;              // ë©˜ì…˜ í…ìŠ¤íŠ¸ ê¸¸ì´
    }>;

    // ì‘ë‹µ ë©”ì„œë“œ
    send: (text: string) => boolean;  // í…ìŠ¤íŠ¸ ì „ì†¡, í•­ìƒ true ë°˜í™˜
    sendMedia: (media: string | string[], timeoutMs?: number, fileName?: string) => boolean;
}</code></pre>

            <h3 id="api-feed">Feed ê°ì²´</h3>
            <pre><code>interface Feed {
    feedType: number | string;    // í”¼ë“œ íƒ€ì… (2: í‡´ì¥, 4: ì…ì¥, 6: ê°•í‡´)
    roomId?: string;              // ë°© ID

    // ì‘ë‹µ ë©”ì„œë“œ
    send: (text: string) => boolean;
    sendMedia: (media: string | string[], timeoutMs?: number, fileName?: string) => boolean;
}</code></pre>

            <h3 id="api-router">Router API</h3>
            <pre><code>// ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ ë“±ë¡
context.registerMessage(
    handler: (msg: Message) => boolean | void,
    priority?: number  // ê¸°ë³¸ê°’: 100
): void

// í”¼ë“œ í•¸ë“¤ëŸ¬ ë“±ë¡
context.registerFeed(
    feedType: number,
    handler: (feed: Feed) => boolean | void,
    priority?: number
): void</code></pre>

            <h3 id="api-queue">Queue & Sender</h3>
            <pre><code>// í…ìŠ¤íŠ¸ ì „ì†¡ íì— ì¶”ê°€
enqueueText(target: string | bigint, text: string): void

// ë¯¸ë””ì–´ ì „ì†¡ íì— ì¶”ê°€
enqueueMedia(
    target: string | bigint,
    media: string | string[],
    timeoutMs?: number,
    fileName?: string
): void</code></pre>

            <h3 id="api-hydrator">Hydrator</h3>
            <pre><code>// 4000ì ì´ìƒ ë©”ì‹œì§€ ì „ë¬¸ ê°€ì ¸ì˜¤ê¸° (ê¸°ë³¸ ì ìš©ë¨)
ensureFullContent(raw: RawData): string

// ë‹µì¥ ì›ë³¸ ë©”ì‹œì§€ ì¡°íšŒ
resolveReplyOriginal(srcId: string): Message | null

// IDë¡œ ìœ ì € ì´ë¦„ ì¡°íšŒ
getUserNameWithId(userId: string | bigint): string | null

// í”„ë¡œí•„ ì´ë¯¸ì§€ URL ì¡°íšŒ
getProfileImageUrl(userId: string | bigint, channelId: string | bigint): string | null

// ë°© ë‚´ ëª¨ë“  ë©¤ë²„ ID ì¡°íšŒ
getAllMemberIds(channelId: string | bigint): string[]

// ë°© íƒ€ì… ì¡°íšŒ
getRoomType(channelId: string | bigint): { isOpenChat: boolean, isGroupChat: boolean } | null</code></pre>

            <h3 id="api-utils">Utils</h3>
            <pre><code>// ëª…ë ¹ì–´ íŒŒì‹±
parseCommand(content: string, prefix?: string): {
    cmd: string;      // ì†Œë¬¸ì ëª…ë ¹ì–´
    args: string[];   // ì¸ì ë°°ì—´
    payload: string;  // ì „ì²´ payload
}

// SQLite ì¿¼ë¦¬
executeQuery(query: string): object | null

// ê¶Œí•œ ì²´í¬
isAdmin(userId: string | bigint): boolean
isBanned(userId: string | bigint): boolean

// ìˆ«ì í¬ë§·íŒ…
splitNum(num: number): string  // 1000 â†’ "1,000"</code></pre>

            <h3 id="api-kakaolink">KakaoLink (ì»¤ìŠ¤í…€ ëª¨ë“ˆ)</h3>

            <div class="alert alert-info">
                <strong>â„¹ï¸ ì •ë³´:</strong> KakaoLinkëŠ” ì¹´ì¹´ì˜¤ ê°œë°œì ì„¼í„°ì˜ ì»¤ìŠ¤í…€ í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€, ë²„íŠ¼ ë“±ì´ í¬í•¨ëœ ë¦¬ì¹˜ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ” ëª¨ë“ˆì…ë‹ˆë‹¤.<br>
                <strong>ì›ë³¸:</strong> <a href="https://github.com/ye-seola/kakaolink-py" target="_blank">kakaolink-py by ye-seola</a> (Python â†’ JavaScript í¬íŒ…)
            </div>

            <h4>ì£¼ìš” íŠ¹ì§•</h4>
            <ul>
                <li><strong>Iris AOT ìë™ ì—°ë™</strong>: ë³„ë„ ì¸ì¦ ì—†ì´ ìë™ ë¡œê·¸ì¸</li>
                <li><strong>ì„¸ì…˜ ìë™ ê´€ë¦¬</strong>: ì¿ í‚¤ ê¸°ë°˜ ì„¸ì…˜ ìœ ì§€ ë° ìë™ ê°±ì‹ </li>
                <li><strong>2FA ìë™ ì²˜ë¦¬</strong>: ì¶”ê°€ ì¸ì¦ ìë™ í•´ê²°</li>
                <li><strong>ë¦¬ì¹˜ ë©”ì‹œì§€ ì „ì†¡</strong>: ì´ë¯¸ì§€, ë²„íŠ¼, ë¦¬ìŠ¤íŠ¸ ë“± ë‹¤ì–‘í•œ í˜•íƒœ ì§€ì›</li>
            </ul>

            <h4>ì´ˆê¸°í™”</h4>
            <pre><code>const { create } = require("adapters/external/kakaolink");

// 1. ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
const kaling = create({
    app_key: "YOUR_APP_KEY",    // í•„ìˆ˜: ì¹´ì¹´ì˜¤ ê°œë°œì ì„¼í„° JavaScript í‚¤
    origin: "YOUR_ORIGIN",      // í•„ìˆ˜: ë“±ë¡í•œ origin (ì˜ˆ: https://yourdomain.com)

    // ì„ íƒì  ì˜µì…˜
    searchExact: true,          // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë°© ì´ë¦„ ê²€ìƒ‰ (ê¸°ë³¸ê°’: true)
    searchFrom: "ALL",          // ê²€ìƒ‰ ë²”ìœ„: "ALL" | "FRIENDS" | "CHATROOMS"
    searchRoomType: "ALL",      // ë°© íƒ€ì…: "ALL" | "OpenMultiChat" | "MultiChat" | "DirectChat"
    getAuthorization: null,     // ì»¤ìŠ¤í…€ ì¸ì¦ í•¨ìˆ˜ (ê¸°ë³¸ê°’: Iris AOT)
    cookiePath: "custom.json"   // ì¿ í‚¤ ì €ì¥ ê²½ë¡œ
});

// 2. ì´ˆê¸°í™” (ì„¸ì…˜ í™•ì¸ ë° ë¡œê·¸ì¸)
kaling.init();</code></pre>

            <h4>ë©”ì‹œì§€ ì „ì†¡</h4>
            <pre><code>// ê¸°ë³¸ ì „ì†¡
const success = kaling.send(
    "ë°© ì´ë¦„",           // receiverName: ì¹´ì¹´ì˜¤í†¡ ë°© ì´ë¦„ ë˜ëŠ” ì¹œêµ¬ ë‹‰ë„¤ì„
    112762,              // templateId: ì»¤ìŠ¤í…€ í…œí”Œë¦¿ ID
    {                    // templateArgs: í…œí”Œë¦¿ ì¸ì (í…œí”Œë¦¿ ë³€ìˆ˜ëª…ê³¼ ì¼ì¹˜)
        uid: "800000000",
        nickname: "ìœ ì €ë‹‰ë„¤ì„",
        profile: "https://example.com/profile.jpg",
        rank: "60"
    }
);

if (success) {
    Logger.i("kakaolink", "ì „ì†¡ ì„±ê³µ");
} else {
    Logger.e("kakaolink", "ì „ì†¡ ì‹¤íŒ¨");
}

// ê²€ìƒ‰ ì˜µì…˜ ì‚¬ìš©
kaling.send("ë°© ì´ë¦„", templateId, templateArgs, {
    searchExact: false,         // ë¶€ë¶„ ì¼ì¹˜ ê²€ìƒ‰
    searchFrom: "CHATROOMS",    // ì±„íŒ…ë°©ë§Œ ê²€ìƒ‰
    searchRoomType: "MultiChat" // ì¼ë°˜ ë‹¨ì²´ ì±„íŒ…ë°©ë§Œ
});</code></pre>

            <h4>ì‹¤ì „ ì˜ˆì œ: ì§€ì—° ì´ˆê¸°í™” íŒ¨í„´</h4>
            <pre><code>const { create } = require("adapters/external/kakaolink");
const { KALING_APP_KEY, KALING_ORIGIN } = require("shared/config");

let kaling = null;

// ì§€ì—° ì´ˆê¸°í™”: í•„ìš”í•  ë•Œë§Œ ìƒì„±
function ensureKaling() {
    if (kaling) return kaling;

    try {
        kaling = create({
            app_key: KALING_APP_KEY,
            origin: KALING_ORIGIN
        });
        kaling.init();
        return kaling;
    } catch (e) {
        Logger.e("feature.js", e);
        return null;
    }
}

// ì‚¬ìš© ì˜ˆì‹œ: í…ìŠ¤íŠ¸ í´ë°± íŒ¨í„´
function sendUserInfo(userInfo, roomName) {
    // 1. KakaoLink ìš°ì„  ì‹œë„
    const KL = ensureKaling();
    if (KL && roomName) {
        try {
            const ok = KL.send(roomName, 112762, {
                uid: userInfo.uid,
                nickname: userInfo.nickname,
                profile: userInfo.profileUrl,
                rank: userInfo.level
            });

            if (ok) return true;  // ì„±ê³µ ì‹œ ì¢…ë£Œ
        } catch (e) {
            Logger.e("feature.js", e);
        }
    }

    // 2. ì‹¤íŒ¨ ì‹œ í…ìŠ¤íŠ¸ë¡œ í´ë°±
    const text = buildTextMessage(userInfo);
    return msg.send(text);
}</code></pre>

            <h4>ê²€ìƒ‰ ì˜µì…˜ í™œìš©</h4>
            <table>
                <thead>
                    <tr>
                        <th>ì˜µì…˜</th>
                        <th>ê°’</th>
                        <th>ì„¤ëª…</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>searchExact</code></td>
                        <td><code>true</code> (ê¸°ë³¸ê°’)</td>
                        <td>ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë°© ì´ë¦„ë§Œ ê²€ìƒ‰</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><code>false</code></td>
                        <td>ë°© ì´ë¦„ì— í¬í•¨ëœ ë¬¸ìì—´ë¡œ ê²€ìƒ‰</td>
                    </tr>
                    <tr>
                        <td><code>searchFrom</code></td>
                        <td><code>"ALL"</code> (ê¸°ë³¸ê°’)</td>
                        <td>ì¹œêµ¬ + ì±„íŒ…ë°© ëª¨ë‘ ê²€ìƒ‰</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><code>"FRIENDS"</code></td>
                        <td>ì¹œêµ¬ë§Œ ê²€ìƒ‰</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><code>"CHATROOMS"</code></td>
                        <td>ì±„íŒ…ë°©ë§Œ ê²€ìƒ‰</td>
                    </tr>
                    <tr>
                        <td><code>searchRoomType</code></td>
                        <td><code>"ALL"</code> (ê¸°ë³¸ê°’)</td>
                        <td>ëª¨ë“  íƒ€ì…ì˜ ë°© ê²€ìƒ‰</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><code>"OpenMultiChat"</code></td>
                        <td>ì˜¤í”ˆ ì±„íŒ…ë°©ë§Œ</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><code>"MultiChat"</code></td>
                        <td>ì¼ë°˜ ë‹¨ì²´ ì±„íŒ…ë°©ë§Œ</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><code>"DirectChat"</code></td>
                        <td>1:1 ì±„íŒ…ë°©ë§Œ</td>
                    </tr>
                </tbody>
            </table>

            <h4>ì£¼ì˜ì‚¬í•­</h4>
            <div class="alert alert-warning">
                <strong>âš ï¸ ì‚¬ì „ ì¤€ë¹„ í•„ìˆ˜</strong>
                <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                    <li>ì¹´ì¹´ì˜¤ ê°œë°œì ì„¼í„°ì—ì„œ ì•± ë“±ë¡ ë° JavaScript í‚¤ ë°œê¸‰</li>
                    <li>ì»¤ìŠ¤í…€ í…œí”Œë¦¿ ìƒì„± ë° í…œí”Œë¦¿ ID í™•ì¸</li>
                    <li>Origin ë“±ë¡ (ì˜ˆ: <code>https://yourdomain.com</code>)</li>
                    <li><code>templateArgs</code>ì˜ í‚¤ëŠ” í…œí”Œë¦¿ ë³€ìˆ˜ëª…ê³¼ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•¨</li>
                    <li>Iris AOT ì„œë²„ ì—°ë™ (ìë™ ì¸ì¦ì„ ìœ„í•´ í•„ìš”)</li>
                </ol>
            </div>

            <h4>ë””ë²„ê¹… íŒ</h4>
            <pre><code>// 1. ì´ˆê¸°í™” ìƒíƒœ í™•ì¸
const KL = ensureKaling();
if (!KL) {
    Logger.e("feature.js", "KakaoLink ì´ˆê¸°í™” ì‹¤íŒ¨");
}

// 2. ì „ì†¡ ê²°ê³¼ ë¡œê¹…
const success = KL.send(roomName, templateId, args);
Logger.d("feature.js", `ì „ì†¡ ê²°ê³¼: ${success ? "ì„±ê³µ" : "ì‹¤íŒ¨"}`);

// 3. í…œí”Œë¦¿ ì¸ì í™•ì¸
Logger.d("feature.js", templateArgs);  // ìë™ìœ¼ë¡œ JSON.stringify

// 4. ë°© ì´ë¦„ í™•ì¸
Logger.d("feature.js", `ë°© ì´ë¦„: ${msg.room.name}`);</code></pre>

            <h4>ì°¸ê³  íŒŒì¼</h4>
            <ul>
                <li><code>node_modules/adapters/external/kakaolink.js</code> - ëª¨ë“ˆ êµ¬í˜„</li>
                <li><a href="https://github.com/ye-seola/kakaolink-py" target="_blank">ì›ë³¸ ë ˆí¬ì§€í† ë¦¬ (Python)</a></li>
            </ul>
        </section>

        <section id="thread-safety">
            <h2>ê³ ê¸‰ ì£¼ì œ</h2>

            <h3>Thread Safety ê°€ì´ë“œ</h3>

            <h4>âš ï¸ ì§€ì–‘ ì‚¬í•­</h4>
            <pre><code>// âŒ Java Threadì—ì„œ Bot API í˜¸ì¶œ ì§€ì–‘
httpServer.onPost = (data) => {
    Bot.send(roomId, "ë©”ì‹œì§€");
};

// âŒ Background Thread ë‚´ì—ì„œ ì§ì ‘ Bot API í˜¸ì¶œ ì§€ì–‘
App.runOnBackgroundThread(() => {
    Bot.send(roomId, "ë©”ì‹œì§€");
});</code></pre>

            <h4>âœ… ê¶Œì¥ íŒ¨í„´</h4>
            <pre><code>// âœ… ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œë§Œ Bot API í˜¸ì¶œ
function handleMessage(msg) {
    msg.send("ì•ˆì „í•œ ì „ì†¡");  // ë‚´ë¶€ì ìœ¼ë¡œ í ì‚¬ìš©
}

// âœ… ê³µìœ  ìƒíƒœëŠ” ConcurrentQueue ì‚¬ìš©
const inbox = new (Java.type("java.util.concurrent.ConcurrentLinkedQueue"))();

// Java Threadì—ì„œ ì¶”ê°€
inbox.add(data);

// ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì²˜ë¦¬
setInterval(() => {
    while (!inbox.isEmpty()) {
        const item = inbox.poll();
        Bot.send(roomId, item);
    }
}, 100);</code></pre>
        </section>

        <section id="troubleshooting">
            <h2>ë¬¸ì œ í•´ê²°</h2>

            <h3>ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜</h3>

            <h4>1. ë©”ì‹œì§€ê°€ ì „ì†¡ë˜ì§€ ì•ŠìŒ</h4>
            <p><strong>ì›ì¸:</strong> íê°€ ì‹œì‘ë˜ì§€ ì•ŠìŒ ë˜ëŠ” ì¤‘ë‹¨ë¨</p>
            <p><strong>í•´ê²°:</strong></p>
            <pre><code>// main.jsì—ì„œ í™•ì¸
queue.start();  // ë¶€íŒ… ì‹œ í˜¸ì¶œ í™•ì¸

// ë””ë²„ê¹…
const { size } = require("infra/queue");
Logger.i(_SCRIPT_NAME, `í í¬ê¸°: ${size()}`);</code></pre>

            <h4>2. "Module not found: shared/logger"</h4>
            <p><strong>ì›ì¸:</strong> ìƒëŒ€ ê²½ë¡œ ì‚¬ìš©</p>
            <p><strong>í•´ê²°:</strong></p>
            <pre><code>// âŒ ì˜ëª»ëœ ê²½ë¡œ
require("../shared/logger");

// âœ… ì˜¬ë°”ë¥¸ ê²½ë¡œ
require("shared/logger");  // node_modules ê¸°ì¤€</code></pre>

            <h4>3. í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ</h4>
            <p><strong>ì›ì¸:</strong> Featureê°€ ë“±ë¡ë˜ì§€ ì•ŠìŒ ë˜ëŠ” ë¹„í™œì„±í™”ë¨</p>
            <p><strong>í•´ê²°:</strong></p>
            <pre><code>// 1. router.jsì˜ features ë°°ì—´ì— ì¶”ê°€ í™•ì¸
// 2. featurePolicy í™•ì¸
const enabled = featurePolicy.isEnabledForRoom(roomId, "ê¸°ëŠ¥ëª…");
Logger.d(_SCRIPT_NAME, `ê¸°ëŠ¥ í™œì„±í™” ì—¬ë¶€: ${enabled}`);</code></pre>

            <h3 id="debugging">ë””ë²„ê¹… íŒ</h3>

            <h4>ë¡œê·¸ í™œìš©</h4>
            <pre><code>// ë©”ì‹œì§€ ë‚´ìš© í™•ì¸
Logger.d(_SCRIPT_NAME, `ìˆ˜ì‹ : ${msg.content}`);

// ê°ì²´ ì „ì²´ ì¶œë ¥
Logger.d(_SCRIPT_NAME, msg);</code></pre>

            <h4>í ìƒíƒœ ëª¨ë‹ˆí„°ë§</h4>
            <pre><code>const { size, sizeText, sizeMedia } = require("infra/queue");

Logger.i(_SCRIPT_NAME, `í: ${size()} (í…ìŠ¤íŠ¸: ${sizeText()}, ë¯¸ë””ì–´: ${sizeMedia()})`);</code></pre>
        </section>
    </main>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', savedTheme);
        updateThemeButton(savedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
        });

        function updateThemeButton(theme) {
            themeToggle.textContent = theme === 'dark' ? 'â˜€ï¸ ë¼ì´íŠ¸ëª¨ë“œ' : 'ğŸŒ™ ë‹¤í¬ëª¨ë“œ';
        }

        // Navigation Active State
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('section');

        function setActiveLink() {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (window.pageYOffset >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }

        window.addEventListener('scroll', setActiveLink);

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    window.scrollTo({
                        top: targetSection.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // Search Functionality
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');

        // Build search index
        const searchIndex = [];
        sections.forEach(section => {
            const headings = section.querySelectorAll('h2, h3, h4');
            headings.forEach(heading => {
                searchIndex.push({
                    title: heading.textContent,
                    id: section.id,
                    content: heading.nextElementSibling?.textContent || '',
                    element: heading
                });
            });

            const paragraphs = section.querySelectorAll('p');
            paragraphs.forEach((p, idx) => {
                if (idx < 2) { // Only first 2 paragraphs per section
                    searchIndex.push({
                        title: section.querySelector('h2, h3')?.textContent || 'Untitled',
                        id: section.id,
                        content: p.textContent,
                        element: p
                    });
                }
            });
        });

        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase().trim();

            if (query.length < 2) {
                searchResults.classList.remove('show');
                return;
            }

            const results = searchIndex.filter(item => {
                return item.title.toLowerCase().includes(query) ||
                       item.content.toLowerCase().includes(query);
            }).slice(0, 10);

            if (results.length === 0) {
                searchResults.innerHTML = '<div class="search-result-item"><div class="search-result-title">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div></div>';
            } else {
                searchResults.innerHTML = results.map(result => {
                    const excerpt = getExcerpt(result.content, query);
                    return `
                        <div class="search-result-item" onclick="navigateTo('${result.id}')">
                            <div class="search-result-title">${highlightText(result.title, query)}</div>
                            <div class="search-result-excerpt">${highlightText(excerpt, query)}</div>
                        </div>
                    `;
                }).join('');
            }

            searchResults.classList.add('show');
        });

        function getExcerpt(text, query) {
            const index = text.toLowerCase().indexOf(query.toLowerCase());
            if (index === -1) return text.substring(0, 100) + '...';

            const start = Math.max(0, index - 40);
            const end = Math.min(text.length, index + query.length + 40);
            return (start > 0 ? '...' : '') + text.substring(start, end) + (end < text.length ? '...' : '');
        }

        function highlightText(text, query) {
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        function navigateTo(id) {
            const section = document.getElementById(id);
            if (section) {
                window.scrollTo({
                    top: section.offsetTop - 80,
                    behavior: 'smooth'
                });
                searchResults.classList.remove('show');
                searchInput.value = '';
            }
        }

        // Close search results when clicking outside
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                searchResults.classList.remove('show');
            }
        });
    </script>
</body>
</html>
